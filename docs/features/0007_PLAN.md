# Calendar Grid View Feature Plan

## Brief Description
Transform the current list-based calendar view into a proper calendar grid that displays events visually. The calendar should show events as clickable elements on dates, with single events displaying truncated labels and multiple events showing as numbered badges that open a day view.

## Current State Analysis
- `CalendarView.tsx` currently renders as a list grouped by date, not a calendar grid
- Event data structure: `{ id, name, type, startUTC, endUTC, city? }`
- Events are accessed via `/app/map/calendar` route with segmented control navigation
- No existing calendar grid component or calendar-specific styles

## Files to Modify

### Core Calendar Implementation
- `src/routes/CalendarView.tsx` - Replace list view with calendar grid component
- `src/lib/calendar.ts` - New utility functions for calendar logic:
  - `getMonthDays(year, month)` - Generate array of days for a month view
  - `groupEventsByDate(events)` - Group events by local date keys
  - `getEventDisplayText(event, maxLength)` - Truncate event names for display
  - `formatCalendarDate(date)` - Format dates for calendar headers

### Styling
- `styles/global.css` - Add calendar-specific CSS classes:
  - `.calendar-grid` - Main calendar container with 7-column grid
  - `.calendar-header` - Month/year header with navigation
  - `.calendar-weekdays` - Row of weekday labels
  - `.calendar-day` - Individual date cells
  - `.calendar-day.today` - Highlight current date
  - `.calendar-day.other-month` - Style for days from adjacent months
  - `.calendar-event` - Individual event display in cells
  - `.calendar-event-count` - Badge for multiple events
  - `.calendar-day-popup` - Modal/popup for day detail view

### Event Display Components
- `src/components/CalendarDay.tsx` - Component for individual date cells
- `src/components/DayEventsModal.tsx` - Modal component for viewing all events on a day
- `src/components/CalendarEvent.tsx` - Component for displaying individual events in calendar cells

## Implementation Details

### Calendar Grid Structure
1. **Month Navigation**: Header with previous/next month buttons and current month/year display
2. **Weekday Headers**: Row showing Mon, Tue, Wed, Thu, Fri, Sat, Sun
3. **Date Grid**: 7-column grid showing dates, with events displayed in cells
4. **Event Display Logic**:
   - If 1 event: Show truncated event name as clickable link
   - If 2+ events: Show event count as clickable badge
   - Clicking either opens event detail or day modal respectively

### Date Calculation Algorithm
1. Get first day of target month
2. Calculate offset to align with Monday (or Sunday based on preference)
3. Generate 35-42 date objects covering the visible month
4. For each date, check if it falls in current month or adjacent months
5. Group events by local date using existing `toLocalDateKey()` logic

### Event Grouping and Display Algorithm
1. Filter events to current month range
2. Group by date key using `toLocalDateKey()`
3. For each date cell:
   - If no events: Empty cell
   - If 1 event: Display truncated name (max 15-20 chars) with ellipsis
   - If 2+ events: Display count badge (e.g., "3 events")

### Navigation and State Management
- Month/year state managed with useState
- Navigation functions: `goToPreviousMonth()`, `goToNextMonth()`, `goToToday()`
- URL state sync for deep linking (optional enhancement)

## Data Flow
1. CalendarView fetches/uses demo data (replace with Firebase later)
2. Groups events by date using existing utility functions
3. Passes grouped data to CalendarDay components
4. CalendarDay components render appropriate display based on event count
5. Clicks trigger navigation to EventDetail or DayEventsModal

## Phase 1: Core Calendar Grid
- Implement basic 7-column grid layout
- Add month navigation header
- Create date cells with proper weekday alignment
- Style calendar appearance to match app theme

## Phase 2A: Event Display
- Add event grouping logic
- Implement single event display (truncated, clickable)
- Add multiple event count badge
- Style event elements in calendar cells

## Phase 2B: Day Modal
- Create DayEventsModal component
- Implement modal display logic
- Add navigation from calendar cells to modal
- Style modal to match app design

## Dependencies
- No external calendar libraries required - pure CSS grid implementation
- Leverages existing event data structure and routing
- Compatible with current responsive design patterns
